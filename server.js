!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=16)}([function(e,t){e.exports=require("firebase")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("dotenv/config")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("oauth")},function(e,t){e.exports=require("xml-js")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("firebase/app")},function(e,t){e.exports=require("core-js/stable")},function(e,t){e.exports=require("regenerator-runtime/runtime")},function(e,t){e.exports=require("firebase/storage")},function(e,t){e.exports=require("xhr2")},function(e,t,r){"use strict";r.r(t);r(12),r(13),r(2);var n=r(6),o=r.n(n),a=r(3),i=r.n(a),s=r(7),u=r.n(s),c=r(0),f=r.n(c);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function d(e){var t="function"==typeof Map?new Map:void 0;return(d=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return v(e,arguments,b(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),y(n,e)})(e)}function v(e,t,r){return(v=g()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&y(o,r.prototype),o}).apply(null,arguments)}function g(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(o,e);var t,r,n=(t=o,r=g(),function(){var e,n=b(t);if(r){var o=b(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return h(this,e)});function o(e,t){var r;l(this,o);for(var a=arguments.length,i=new Array(a>2?a-2:0),s=2;s<a;s++)i[s-2]=arguments[s];return(r=n.call.apply(n,[this].concat(i))).httpCode=e,r.userMessage=t,r}return o}(d(Error)),w=function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Someting went wrong. Try again.",n=500;if(e.userMessage)throw e;if(!e.code)throw new m(n,r);throw"auth/email-already-in-use"===e.code?t="The email is already in use":"auth/invalid-email"===e.code?(t="Invalid email",n=400):"auth/weak-password"===e.code?(t="Password must be at least 6 symbols long",n=400):"auth/user-disabled"===e.code?t="Account with given email has been disabled.":"auth/user-not-found"===e.code?(t="User with that email does not exist!",n=404):t="auth/wrong-password"===e.code?"Incorrect password!":e.code.includes("different-credential")?"Email is already associated with another account":r,new m(n,t)},k=r(8),x=r.n(k);function O(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function S(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach((function(t){R(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function R(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function j(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function B(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){j(a,n,o,i,s,"next",e)}function s(e){j(a,n,o,i,s,"throw",e)}i(void 0)}))}}function P(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var C=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.tokenService=t,this.consumer=new x.a.OAuth("https://twitter.com/oauth/request_token","https://twitter.com/oauth/access_token",process.env.TWITTER_KEY,process.env.TWITTER_SECRET,"1.0A",process.env.TWITTER_CALLBACK,"HMAC-SHA1")}var t,r,n,o,a,i,s,u,c;return t=e,(r=[{key:"getUserProfile",value:(c=B(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.firestore().collection("users").doc(t).get();case 2:if((r=e.sent).exists){e.next=5;break}return e.abrupt("return",null);case 5:return(n=r.data()).id=t,e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"createToken",value:function(e,t){return this.tokenService.createToken({id:e,email:t},2592e3)}},{key:"getUser",value:(u=B(regeneratorRuntime.mark((function e(t,r){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.auth().signInWithEmailAndPassword(t,r);case 3:return n=f.a.auth().currentUser.uid,o=this.createToken(n,t),e.next=7,this.getUserProfile(n);case 7:if(a=e.sent){e.next=10;break}throw new m(404,"User with email ".concat(t," does not exist!"));case 10:return e.abrupt("return",S(S({},a),{},{token:o}));case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0),w(e.t0,"Someting went wrong while signing you in! Try again!");case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e,t){return u.apply(this,arguments)})},{key:"createUser",value:(s=B(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,f.a.auth().createUserWithEmailAndPassword(t,r);case 3:return n=f.a.auth().currentUser.uid,e.next=6,this.saveUser(t,n);case 6:return o=e.sent,e.abrupt("return",S({},o));case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0),w(e.t0,"Ooops! Something went wrong while creating your account! Try again.");case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e,t){return s.apply(this,arguments)})},{key:"saveUser",value:(i=B(regeneratorRuntime.mark((function e(t,r){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={email:t},o=f.a.firestore().collection("users").doc(r),e.next=4,o.set(n);case 4:return n.id=r,a=this.createToken(r,t),e.abrupt("return",S(S({},n),{},{token:a}));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"signInGoogle",value:(a=B(regeneratorRuntime.mark((function e(t){var r,n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=f.a.auth.GoogleAuthProvider.credential(t),e.next=4,f.a.auth().signInWithCredential(r);case 4:if(n=e.sent,!(o=n.user).email){e.next=19;break}return e.next=9,this.getUserProfile(o.uid);case 9:if(a=e.sent,i=this.createToken(o.uid,o.email),!a){e.next=13;break}return e.abrupt("return",S(S({},a),{},{token:i}));case 13:return e.next=15,this.saveUser(o.email,o.uid);case 15:return s=e.sent,e.abrupt("return",S({},s));case 19:throw new m(500,"Failed to authenticate Google user");case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(0),console.log(e.t0),w(e.t0,"Ooops! Something went wrong while linking your Google account! Try again.");case 26:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(e){return a.apply(this,arguments)})},{key:"getAuthorizeUrl",value:function(){var e=this;return new Promise((function(t,r){e.consumer.getOAuthRequestToken((function(e,n,o){e&&r(new m(500,"Failed to get request token")),t({url:"https://api.twitter.com/oauth/authenticate?oauth_token=".concat(n)})}))}))}},{key:"getAccessToken",value:function(e,t){var r=this;return new Promise((function(n,o){r.consumer.getOAuthAccessToken(e,process.env.TWITTER_SECRET,t,(function(e,t,r){e&&o(new m(500,"Failed to get access token")),n({token:t,secret:r})}))}))}},{key:"signInTwitter",value:(o=B(regeneratorRuntime.mark((function e(t,r){var n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=f.a.auth.TwitterAuthProvider.credential(t,r),e.next=4,f.a.auth().signInWithCredential(n);case 4:if(o=e.sent,!(a=o.user).email){e.next=19;break}return e.next=9,this.getUserProfile(a.uid);case 9:if(i=e.sent,s=this.createToken(a.uid,a.email),!i){e.next=13;break}return e.abrupt("return",S(S({},i),{},{token:s}));case 13:return e.next=15,this.saveUser(a.email,a.uid);case 15:return u=e.sent,e.abrupt("return",S({},u));case 19:throw new m(500,"Failed to authenticate Twitter user");case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),w(e.t0,message||"Ooops! Something went wrong while linking your Twitter account! Try again.");case 25:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(e,t){return o.apply(this,arguments)})}])&&P(t.prototype,r),n&&P(t,n),e}(),_=r(4),U=r.n(_);function A(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var F=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.createToken=this.createToken.bind(this),this.validateToken=this.validateToken.bind(this)}var t,r,n;return t=e,(r=[{key:"createToken",value:function(e,t){if(!e||t<=0)throw new m(400,"Error creating a token");return U.a.sign(e,process.env.JWT_KEY,{expiresIn:t})}},{key:"validateToken",value:function(e){if(!e)throw new m(401,"Missing access token");return U.a.verify(e,process.env.JWT_KEY,(function(e,t){if(e){if("jwt expired"===e.message)throw new m(401,"Token has expired");throw new m(401,"Failed to authenticate token")}return t}))}}])&&A(t.prototype,r),n&&A(t,n),e}();function T(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function D(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){T(a,n,o,i,s,"next",e)}function s(e){T(a,n,o,i,s,"throw",e)}i(void 0)}))}}function I(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var E=new C(new F),M=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.authService=t,this.signInUser=this.signInUser.bind(this),this.signUpUser=this.signUpUser.bind(this),this.signInWithGoogle=this.signInWithGoogle.bind(this),this.signInWithTwitter=this.signInWithTwitter.bind(this),this.getRequestUrl=this.getRequestUrl.bind(this)}var t,r,n,o,a,i,s,u;return t=e,(r=[{key:"signInUser",value:(u=D(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("SignIn request accepted"),(n=t.body)&&n.email&&n.password){e.next=5;break}throw new m(400,"User credentials are invalid");case 5:return e.next=7,this.authService.getUser(n.email,n.password);case 7:o=e.sent,r.json(o),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 14:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e,t){return u.apply(this,arguments)})},{key:"signUpUser",value:(s=D(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("SignUp request accepted"),(n=t.body)&&n.email&&n.password){e.next=5;break}throw new m(400,"User credentials are invalid");case 5:return e.next=7,this.authService.createUser(n.email,n.password);case 7:o=e.sent,r.json(o),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 14:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e,t){return s.apply(this,arguments)})},{key:"signInWithGoogle",value:(i=D(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Sign In With Google request accepted"),e.prev=1,n=t.body.token,e.next=5,this.authService.signInGoogle(n);case 5:o=e.sent,r.json(o),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e,t){return i.apply(this,arguments)})},{key:"signInWithTwitter",value:(a=D(regeneratorRuntime.mark((function e(t,r){var n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Sign In With Twitter request accepted"),e.prev=1,n=t.query.token,o=t.query.verifier,console.log(n,o),n&&o){e.next=7;break}throw new m(400,"Invalid request paramrs");case 7:return e.next=9,this.authService.getAccessToken(n,o);case 9:return a=e.sent,e.next=12,this.authService.signInTwitter(a.token,a.secret);case 12:i=e.sent,r.json(i),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(1),console.log(e.t0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 20:case"end":return e.stop()}}),e,this,[[1,16]])}))),function(e,t){return a.apply(this,arguments)})},{key:"getRequestUrl",value:(o=D(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Get OAuth Request Token request accepted"),e.prev=1,e.next=4,this.authService.getAuthorizeUrl();case 4:n=e.sent,console.log(n),r.json(n),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e,t){return o.apply(this,arguments)})}])&&I(t.prototype,r),n&&I(t,n),e}())(E),q=r(5),G=r.n(q),W=r(9),Y=r.n(W);function V(e){return(V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function H(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function L(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){H(a,n,o,i,s,"next",e)}function s(e){H(a,n,o,i,s,"throw",e)}i(void 0)}))}}function N(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var K=process.env.GOODREADS_KEY,z=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n,o,a;return t=e,(r=[{key:"getValueFromGoodreads",value:(a=L(regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,G.a.get(t);case 3:if(!((r=e.sent).status>=300)){e.next=6;break}throw new m(r.status,"Failed to retrieve book data");case 6:return n=r.data,o=Y.a.xml2js(n,{compact:!0}),e.abrupt("return",o);case 11:if(e.prev=11,e.t0=e.catch(0),!e.t0.userMessage){e.next=15;break}throw e.t0;case 15:if(!e.t0.response||404!=e.t0.response.status){e.next=17;break}throw new m(e.t0.response.status,"Book was not found");case 17:throw new m(500,"Something went wrong while retrieving book info!");case 18:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e){return a.apply(this,arguments)})},{key:"getHQImage",value:(o=L(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="",!t.includes("nophoto")||!r){e.next=14;break}return n="".concat("https://pictures.abebooks.com/isbn/").concat(r,".jpg"),e.prev=3,e.next=6,G.a.get(n);case 6:if(404===e.sent.status){e.next=9;break}return e.abrupt("return",n);case 9:e.next=14;break;case 11:return e.prev=11,e.t0=e.catch(3),e.abrupt("return","https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png");case 14:return e.abrupt("return",t);case 15:case"end":return e.stop()}}),e,null,[[3,11]])}))),function(e,t){return o.apply(this,arguments)})},{key:"findValue",value:function(e,t){var r,n=this;return Object.keys(e).some((function(o){return o===t?(r=e[o],!0):e[o]&&"object"===V(e[o])?void 0!==(r=n.findValue(e[o],t)):void 0})),r}},{key:"root",get:function(){return"https://www.goodreads.com/"}},{key:"devKey",get:function(){return K}}])&&N(t.prototype,r),n&&N(t,n),e}();function J(e){return(J="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function X(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Q(a,n,o,i,s,"next",e)}function s(e){Q(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=re(e);if(t){var o=re(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return te(this,r)}}function te(e,t){return!t||"object"!==J(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function re(e){return(re=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ne=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}(u,e);var t,r,n,o,a,i,s=ee(u);function u(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(t=s.call(this)).formatBookService=e,t}return t=u,(r=[{key:"searchBooks",value:(i=X(regeneratorRuntime.mark((function e(t){var r,n,o,a,i=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r="".concat(this.root,"search/index.xml?key=").concat(this.devKey,"&q=").concat(t),e.next=4,this.getValueFromGoodreads(r);case 4:if(n=e.sent,o=this.findValue(n,"work")){e.next=8;break}throw new m(404,"No books can be found");case 8:return a=o.slice(0,4).map((function(e){var t=i.findValue(e,"best_book");return i.formatBookService.formatBookForSearch(t)})),e.abrupt("return",a);case 12:if(e.prev=12,e.t0=e.catch(0),!e.t0.userMessage){e.next=18;break}throw e.t0;case 18:throw new m(500,"Something went wrong while searching for book");case 19:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e){return i.apply(this,arguments)})},{key:"getBookWithUserData",value:(a=X(regeneratorRuntime.mark((function e(t,r){var n,o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.fetchUserBookData(r,t);case 3:if(!(n=e.sent)){e.next=8;break}return e.abrupt("return",n);case 8:return o="".concat(this.root,"book/show/").concat(t,".xml?key=").concat(this.devKey),e.next=11,this.getValueFromGoodreads(o);case 11:if(a=e.sent,i=this.findValue(a,"book")){e.next=15;break}throw new m(404,"Book not found");case 15:return s=this.formatBookService.formatBookForBookPage(i),e.next=18,this.getHQImage(s.imageUrl,s.isbn);case 18:return s.imageUrl=e.sent,e.abrupt("return",s);case 20:e.next=27;break;case 22:if(e.prev=22,e.t0=e.catch(0),!e.t0.userMessage){e.next=26;break}throw e.t0;case 26:throw new m(500,"Something went wrong while retrieving book");case 27:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(e,t){return a.apply(this,arguments)})},{key:"fetchUserBookData",value:(o=X(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.firestore().collection("users").doc(t).collection("books").where("id","==",r).get();case 2:if(!(n=e.sent).empty){e.next=7;break}return e.abrupt("return",!1);case 7:return e.abrupt("return",n.docs[0].data());case 8:case"end":return e.stop()}}),e)}))),function(e,t){return o.apply(this,arguments)})}])&&Z(t.prototype,r),n&&Z(t,n),u}(z);function oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ae=["to-read","currently-reading","owned","default","favorites","books-i-own","ebook","kindle","library","audiobook","owned-books","audiobooks","my-books","ebooks","to-buy","english","calibre","books","british","audio","my-library","favourites","re-read","general","e-books","fiction","ya","series","classic"],ie=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n;return t=e,(r=[{key:"mapArrayIds",value:function(e){return e.map((function(e){return e.id._text}))}},{key:"formatGenresForBook",value:function(e){var t=e.filter((function(e){return!ae.includes(e._attributes.name)})).map((function(e){return e._attributes.name.replace(/^\w/,(function(e){return e.toUpperCase()}))}));return t.length>3?t.slice(0,3):t}},{key:"getBookTitle",value:function(e){if(!e)return null;var t=e,r=t.indexOf("(");return t.substring(0,r>0?r:t.length).trim()}},{key:"formatDescription",value:function(e){if(!e)return"";var t=e.replace(new RegExp(/<br\s*\/?>/g),"\n");return t=t.replace(new RegExp(/<[^>]*>/g),"")}},{key:"formatSeriesForBook",value:function(e){if(!e)return null;Array.isArray(e)&&(e=e[0]);var t=e.series.id._text,r=e.user_position._text?" #".concat(e.user_position._text):"";return{id:t,fullName:"(".concat(e.series.title._cdata.trim()).concat(r,")")}}},{key:"formatAuthor",value:function(e){return Array.isArray(e)?this.getAllBookAuthors(e):[this.mapAuthor(e)]}},{key:"formatAuthorForSearch",value:function(e){return Array.isArray(e)?e[0].name._text:e.name._text}},{key:"getAllBookAuthors",value:function(e){var t=this;return e.filter((function(e){return!e.role._text})).map((function(e){return t.mapAuthor(e)}))}},{key:"mapAuthor",value:function(e){return{id:e.id._text,name:e.name._text,imageUrl:e.image_url._cdata,smallImageUrl:e.small_image_url._cdata,goodreadsRating:e.average_rating._text}}},{key:"getLargeImageUrl",value:function(e){if(!e||e.includes("nophoto"))return e;var t=new RegExp(/._(.*?)_/g);return e.replace(t,"")}}])&&oe(t.prototype,r),n&&oe(t,n),e}();var se=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.status="not reading",this.rating=0,this.pagesRead=0,this.isFavorited=!1,this.finishTimes=[],this.notes=""};var ue=function e(t,r,n,o,a,i,s,u,c,f,p,l){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.isbn=t,this.id=r,this.title=n,this.imageUrl=o,this.smallImageUrl=a,this.description=i,this.publishedYear=s,this.goodreadsRating=u,this.pages=c,this.authors=f,this.series=p,this.genres=l,this.userData=new se};function ce(e){return(ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function le(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=de(e);if(t){var o=de(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return he(this,r)}}function he(e,t){return!t||"object"!==ce(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function de(e){return(de=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ve=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}(a,e);var t,r,n,o=le(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this)}return t=a,(r=[{key:"formatBookForSearch",value:function(e){try{return{id:e.id._text,title:e.title._text||e.title._cdata,imageUrl:this.getLargeImageUrl(e.image_url._text),author:this.formatAuthorForSearch(e.author)}}catch(e){throw console.log(e),new m(400,"Failed to retrieve data from book")}}},{key:"formatBookForBookPage",value:function(e){try{var t={isbn:e.isbn13._cdata,id:e.id._text,title:this.getBookTitle(e.title._text)||this.getBookTitle(e.title._cdata),imageUrl:this.getLargeImageUrl(e.image_url._text),smallImageUrl:e.small_image_url._text,description:this.formatDescription(e.description._cdata),publishedYear:e.work.original_publication_year._text,goodreadsRating:e.average_rating._text,pages:e.num_pages._cdata};return t.authors=this.formatAuthor(e.authors.author),t.series=this.formatSeriesForBook(e.series_works.series_work),t.genres=this.formatGenresForBook(e.popular_shelves.shelf),new ue(t.isbn,t.id,t.title,t.imageUrl,t.smallImageUrl,t.description,t.publishedYear,t.goodreadsRating,t.pages,t.authors,t.series,t.genres)}catch(e){throw console.log(e),new m(400,"Failed to retrieve data from book")}}}])&&fe(t.prototype,r),n&&fe(t,n),a}(ie),ge=new F;function ye(e){var t=e.headers["x-access-token"];return ge.validateToken(t)}function be(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function me(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){be(a,n,o,i,s,"next",e)}function s(e){be(a,n,o,i,s,"throw",e)}i(void 0)}))}}function we(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ke=new ne(new ve),xe=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.goodreadsBookService=t,this.searchByTitleOrAuthor=this.searchByTitleOrAuthor.bind(this),this.getBookById=this.getBookById.bind(this)}var t,r,n,o,a;return t=e,(r=[{key:"searchByTitleOrAuthor",value:(a=me(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Search request accepted!"),n=t.query.query){e.next=5;break}throw new m(400,"Search query is empty");case 5:return ye(t),e.next=8,this.goodreadsBookService.searchBooks(n);case 8:o=e.sent,r.json(o),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return a.apply(this,arguments)})},{key:"getBookById",value:(o=me(regeneratorRuntime.mark((function e(t,r){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Get Book By Id request accepted"),(n=t.params.bookId)&&!isNaN(n)){e.next=5;break}throw new m(400,"Book identifier is invalid");case 5:return o=ye(t),e.next=8,this.goodreadsBookService.getBookWithUserData(n,o.id);case 8:a=e.sent,r.json(a),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return o.apply(this,arguments)})}])&&we(t.prototype,r),n&&we(t,n),e}())(ke);function Oe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Se(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(r),!0).forEach((function(t){Re(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Oe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Re(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function je(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Be(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n,o,a;return t=e,(r=[{key:"getUserById",value:(o=regeneratorRuntime.mark((function e(t){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=f.a.firestore().collection("users").doc(t),e.next=4,r.get();case 4:if((n=e.sent).exists){e.next=9;break}throw new m(404,"User not found");case 9:return o=n.data(),e.abrupt("return",Se(Se({},o),{},{id:t}));case 11:e.next=21;break;case 13:if(e.prev=13,e.t0=e.catch(0),console.log(e.t0),!e.t0.userMessage){e.next=20;break}throw e.t0;case 20:throw new m(500,"Could not retrieve user");case 21:case"end":return e.stop()}}),e,null,[[0,13]])})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){je(a,r,n,i,s,"next",e)}function s(e){je(a,r,n,i,s,"throw",e)}i(void 0)}))},function(e){return a.apply(this,arguments)})}])&&Be(t.prototype,r),n&&Be(t,n),e}();function Ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _e(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(r),!0).forEach((function(t){Ue(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ue(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ae(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Fe(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Ae(a,n,o,i,s,"next",e)}function s(e){Ae(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var De=["finished","stopped","2read","reading","not reading"],Ie=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.feedService=t}var t,r,n,o,a,i,s,u,c,p,l;return t=e,(r=[{key:"getUserBooksAsFBCollection",value:function(e){return f.a.firestore().collection("users").doc(e).collection("books")}},{key:"getUserBooksAsArray",value:(l=Fe(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserBooksAsFBCollection(t).orderBy("timestamp","desc").get();case 3:if(!(r=e.sent).empty){e.next=8;break}return e.abrupt("return",[]);case 8:return e.abrupt("return",r.docs.map((function(e){return e.data()})));case 9:e.next=17;break;case 11:if(e.prev=11,e.t0=e.catch(0),console.log(e.t0),!e.t0.userMessage){e.next=16;break}throw e.t0;case 16:throw new m(500,"Could not retrieve user books");case 17:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e){return l.apply(this,arguments)})},{key:"getUserCollection",value:(p=Fe(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,De.includes(r.toLowerCase())){e.next=3;break}throw new m(400,"Book status is invalid");case 3:return n=this.getUserBooksAsFBCollection(t),e.next=6,n.where("userData.status","==",r).get();case 6:if(!(o=e.sent).empty){e.next=11;break}return e.abrupt("return",[]);case 11:return e.abrupt("return",o.docs.map((function(e){return e.data()})));case 12:e.next=20;break;case 14:if(e.prev=14,e.t0=e.catch(0),console.log(e.t0),!e.t0.userMessage){e.next=19;break}throw e.t0;case 19:throw new m(500,"Ooops! Something went wrong while retrieving user books");case 20:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(e,t){return p.apply(this,arguments)})},{key:"addToUserCollection",value:(c=Fe(regeneratorRuntime.mark((function e(t,r,n){var o,a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,De.includes(r.toLowerCase())){e.next=3;break}throw new m(400,"Book status is invalid");case 3:return o=this.getUserBooksAsFBCollection(t),e.next=6,o.where("id","==",n.id).get();case 6:if(a=e.sent,n.userData.status=r,!a.empty){e.next=13;break}return e.next=11,o.doc().set(_e(_e({},n),{},{timestamp:f.a.firestore.FieldValue.serverTimestamp()}));case 11:e.next=17;break;case 13:return i=a.docs[0],s=i.id,e.next=17,o.doc(s).update({userData:n.userData});case 17:return e.next=19,this.feedService.saveFeed(n,r,t);case 19:return e.abrupt("return",n);case 22:if(e.prev=22,e.t0=e.catch(0),!e.t0.userMessage){e.next=26;break}throw e.t0;case 26:throw new m(500,"Something went wrong while updating user books!");case 27:case"end":return e.stop()}}),e,this,[[0,22]])}))),function(e,t,r){return c.apply(this,arguments)})},{key:"deleteBookFromCollection",value:(u=Fe(regeneratorRuntime.mark((function e(t,r){var n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserBooksAsFBCollection(t).where("id","==",r).get();case 3:if((n=e.sent).empty){e.next=13;break}return o=n.docs[0],a=o.id,this.getUserBooksAsFBCollection(t).doc(a).delete(),(i=o.data()).userData=new se,e.next=12,this.feedService.saveFeed(i,"not",t);case 12:return e.abrupt("return",i);case 13:return e.abrupt("return",!1);case 16:if(e.prev=16,e.t0=e.catch(0),!e.t0.userMessage){e.next=20;break}throw e.t0;case 20:throw new m(500,"Something went wrong while deleting book!");case 21:case"end":return e.stop()}}),e,this,[[0,16]])}))),function(e,t){return u.apply(this,arguments)})},{key:"setFavorite",value:(s=Fe(regeneratorRuntime.mark((function e(t,r){var n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.getUserBooksAsFBCollection(t),e.next=4,n.where("id","==",r.id).get();case 4:if(o=e.sent,r.userData.isFavorited=!r.userData.isFavorited,!o.empty){e.next=11;break}return e.next=9,n.doc().set(r);case 9:e.next=15;break;case 11:return a=o.docs[0],i=a.id,e.next=15,n.doc(i).update({"userData.isFavorited":r.userData.isFavorited});case 15:return e.abrupt("return",r);case 18:if(e.prev=18,e.t0=e.catch(0),!e.t0.userMessage){e.next=22;break}throw e.t0;case 22:throw new m(500,"Something went wrong while updating book!");case 23:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e,t){return s.apply(this,arguments)})},{key:"getFavorites",value:(i=Fe(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserBooksAsFBCollection(t).where("userData.isFavorited","==",!0).get();case 3:if(!(r=e.sent).empty){e.next=6;break}return e.abrupt("return",[]);case 6:return e.abrupt("return",r.docs.map((function(e){return e.data()})));case 9:if(e.prev=9,e.t0=e.catch(0),!e.t0.userMessage){e.next=13;break}throw e.t0;case 13:throw new m(500,"Something went wrong while retrieving user books!");case 14:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return i.apply(this,arguments)})},{key:"updateBook",value:(a=Fe(regeneratorRuntime.mark((function e(t,r){var n,o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=this.getUserBooksAsFBCollection(t),e.next=4,n.where("id","==",r.id).get();case 4:if(!(o=e.sent).empty){e.next=9;break}throw new m(404,"Book not found");case 9:if(a=o.docs[0],i=a.id,s=a.data(),0==(u=r.userData.pagesRead-s.userData.pagesRead)){e.next=16;break}return e.next=16,this.feedService.saveFeed(r,"update",t,{pages:u});case 16:if(!(Math.abs(r.userData.rating-s.userData.rating)>0)){e.next=19;break}return e.next=19,this.feedService.saveFeed(r,"rating",t,{rating:r.userData.rating});case 19:return e.next=21,n.doc(i).update({userData:r.userData});case 21:return e.abrupt("return",r);case 24:if(e.prev=24,e.t0=e.catch(0),!e.t0.userMessage){e.next=28;break}throw e.t0;case 28:throw new m(500,"Ooops! Something went wrong while updating book");case 29:case"end":return e.stop()}}),e,this,[[0,24]])}))),function(e,t){return a.apply(this,arguments)})},{key:"getUserGenres",value:(o=Fe(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserBooksAsArray(t);case 3:return r=e.sent,n={},r.forEach((function(e){e.genres&&e.genres.slice(0,2).forEach((function(e){n.hasOwnProperty(e)?n[e]+=1:n[e]=1}))})),e.abrupt("return",n);case 9:if(e.prev=9,e.t0=e.catch(0),console.log(e.t0),!e.t0.userMessage){e.next=14;break}throw e.t0;case 14:throw new m(500,"Ooops! Something went wrong while retrieving user genres");case 15:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return o.apply(this,arguments)})}])&&Te(t.prototype,r),n&&Te(t,n),e}(),Ee=r(1),Me=r.n(Ee);function qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Ge(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(r),!0).forEach((function(t){We(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):qe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function We(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ye(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Ve(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Ye(a,n,o,i,s,"next",e)}function s(e){Ye(a,n,o,i,s,"throw",e)}i(void 0)}))}}function He(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Le={"2read":"Will be reading",finished:"Finished",stopped:"Stopped reading",update:"Has read",rating:"Has rated",reading:"Started reading",not:"Not reading"},Ne=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n,o,a,i,s;return t=e,(r=[{key:"convertToFBAction",value:function(e){if(!Le[e])return!1;switch(e){case"2read":case"finished":case"stopped":case"reading":return"add";case"update":case"rating":return e;case"not":return"delete"}}},{key:"generateFeed",value:function(e,t,r){var n=r.pages,o=r.rating;return Le[t]&&e&&""!==e.id&&""!==e.title?{date:Me()().format("DD MMM YYYY"),message:"".concat(Le[t]," ").concat(n?n+" pages of ":""),action:this.convertToFBAction(t),data:{id:e.id,title:e.title,rating:o||null}}:null}},{key:"saveFeed",value:(s=Ve(regeneratorRuntime.mark((function e(t,r,n){var o,a,i,s=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.length>3&&void 0!==s[3]?s[3]:{},!(a=this.generateFeed(t,r,o))){e.next=14;break}return e.prev=3,i=this.getUserFeedAsFBCollection(n),e.next=7,i.doc().set(Ge(Ge({},a),{},{timestamp:f.a.firestore.FieldValue.serverTimestamp()}));case 7:e.next=14;break;case 9:if(e.prev=9,e.t0=e.catch(3),!e.t0.userMessage){e.next=13;break}throw e.t0;case 13:throw new m(500,"Something went wrong while recording user feed");case 14:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e,t,r){return s.apply(this,arguments)})},{key:"getUserFeedAsFBCollection",value:function(e){return f.a.firestore().collection("users").doc(e).collection("feed")}},{key:"getAllUserFeed",value:(i=Ve(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.retrieveUserFeed(t);case 2:if(r=e.sent){e.next=5;break}return e.abrupt("return",{});case 5:return e.abrupt("return",this.formatFeed(r));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"getUserFeedByDate",value:(a=Ve(regeneratorRuntime.mark((function e(t,r){var n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Me()(r,"DD MMM YYYY")){e.next=3;break}throw new m(400,"Invalid date parameter");case 3:return e.next=5,this.retrieveUserFeed(t);case 5:if(o=e.sent){e.next=8;break}return e.abrupt("return",{});case 8:if(a=this.formatFeed(o),i=Object.keys(a).find((function(e){var t=Me()(e,"DD MMM YYYY");return n.isSame(t,"days")}))){e.next=12;break}return e.abrupt("return",{});case 12:return e.abrupt("return",We({},i,a[i]));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"retrieveUserFeed",value:(o=Ve(regeneratorRuntime.mark((function e(t){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=this.getUserFeedAsFBCollection(t),e.next=4,r.orderBy("timestamp","desc").get();case 4:if(!(n=e.sent).empty){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",n.docs.map((function(e){return e.data()})));case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(0),new m(500,"Something went wrong while retrieving user feed");case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e){return o.apply(this,arguments)})},{key:"formatFeed",value:function(e){var t=this.cleanFeed(e),r=this.formatFeedByDate(t);return this.mergeUpdateRecords(r),r}},{key:"cleanFeed",value:function(e){var t=new Map,r=e.filter((function(e){if(t.has(e.data.id)){var r=t.get(e.data.id);return!r.some((function(e){return"delete"===e.action}))&&("delete"===e.action?(r.push(e),!1):"update"==e.action||!!r.every((function(t){return t.action!==e.action}))&&(r.push(e),!0))}return t.set(e.data.id,[e]),!0}));return r.sort(ze),r}},{key:"formatFeedByDate",value:function(e){var t={};return e.forEach((function(e){t.hasOwnProperty(e.date)?t[e.date].push(e):t[e.date]=[e]})),console.log(t),t}},{key:"mergeUpdateRecords",value:function(e){var t=this;return Object.keys(e).forEach((function(r){var n=e[r].filter((function(e){return e.message.includes("pages")})),o="";n.forEach((function(a){if(a.data.id!==o||""===o){o=a.data.id;var i=n.filter((function(e){return e.data.id===o})),s=i.reduce(Ke,0),u=t.getMergeIndex(e[r],a.data.id),c=i.length;s>0?e[r].splice(u,c,t.generateFeed(a.data,"update",{pages:s})):e[r].splice(u,c)}}))})),e}},{key:"getMergeIndex",value:function(e,t){var r=e.find((function(e){return e.data.id===t&&e.message.includes("pages")}));return e.indexOf(r)}},{key:"isFeedClean",value:function(e,t){return e.data.id!==t.data.id||e.message.includes("pages")||t.message.includes("pages")}}])&&He(t.prototype,r),n&&He(t,n),e}(),Ke=function(e,t){return e+Number.parseInt(t.message.replace(/[^-\d]/g,""))},ze=function(e,t){var r=Me()(e.date,"DD MMM YYYY"),n=Me()(t.date,"DD MMM YYYY");return r.isAfter(n)?-1:r.isBefore(n)?1:0},Je=Ne;r(14);function Qe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Qe(Object(r),!0).forEach((function(t){Ze(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Qe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ze(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $e(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function et(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){$e(a,n,o,i,s,"next",e)}function s(e){$e(a,n,o,i,s,"throw",e)}i(void 0)}))}}function tt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var rt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n,o,a,i,s,u,c;return t=e,(r=[{key:"getUserBooksAsFBCollection",value:function(e){return f.a.firestore().collection("users").doc(e).collection("books")}},{key:"getPrivateBookById",value:(c=et(regeneratorRuntime.mark((function e(t,r){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserBooksAsFBCollection(t).doc(r).get();case 3:if(!(n=e.sent).exists){e.next=8;break}return e.abrupt("return",Xe({id:n.id},n.data()));case 8:throw new m(404,"Book not found");case 9:e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(0),!e.t0.userMessage){e.next=15;break}throw e.t0;case 15:throw new m(500,"Something went wrong while retrieving user book");case 16:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e,t){return c.apply(this,arguments)})},{key:"getPrivateBooks",value:(u=et(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getUserBooksAsFBCollection(t).where("private","==",!0).get();case 3:if(!(r=e.sent).empty){e.next=8;break}return e.abrupt("return",[]);case 8:return e.abrupt("return",r.docs.map((function(e){return Xe({id:e.id},e.data())})));case 9:e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(0),!e.t0.userMessage){e.next=15;break}throw e.t0;case 15:throw new m(500,"Something went wrong while retrieving user books");case 16:case"end":return e.stop()}}),e,this,[[0,11]])}))),function(e){return u.apply(this,arguments)})},{key:"saveUserBook",value:(s=et(regeneratorRuntime.mark((function e(t,r,n){var o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r.title&&r.author&&!Number.isNaN(+r.pages)){e.next=3;break}throw new m(400,"Book information is invalid");case 3:if(o=this.getUserBooksAsFBCollection(t).doc(),a={id:o.id,title:r.title,authors:r.author,pages:+r.pages,imageUrl:"",description:r.description,userData:Xe({},new se),private:!0},n){e.next=19;break}return a.imageUrl="https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png",e.next=9,o.set(a);case 9:return e.next=11,o.get();case 11:if(!(i=e.sent).exists){e.next=16;break}return e.abrupt("return",Xe({id:i.id},i.data()));case 16:throw new m(500,"Someting wrong happened while saving private book");case 17:e.next=27;break;case 19:return e.next=21,this.saveBookCover(t,o.id,n);case 21:return s=e.sent,e.next=24,this.updateImageUrl(t,o.id,s,a);case 24:return(u=e.sent).id=o.id,e.abrupt("return",u);case 27:e.next=35;break;case 29:if(e.prev=29,e.t0=e.catch(0),console.log(e.t0),!e.t0.userMessage){e.next=34;break}throw e.t0;case 34:throw new m(500,"Something went wrong while saving private book");case 35:case"end":return e.stop()}}),e,this,[[0,29]])}))),function(e,t,r){return s.apply(this,arguments)})},{key:"saveBookCover",value:(i=et(regeneratorRuntime.mark((function e(t,r,n){var o,a,i,s,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=f.a.storage().ref(),a=n.originalname.slice(n.originalname.indexOf(".")),i=o.child(t).child(r).child("cover".concat(a)),s=Uint8Array.from(n.buffer).buffer,u={contentType:n.mimetype},e.next=7,i.put(s,u);case 7:return e.abrupt("return",i.getDownloadURL());case 8:case"end":return e.stop()}}),e)}))),function(e,t,r){return i.apply(this,arguments)})},{key:"updateImageUrl",value:(a=et(regeneratorRuntime.mark((function e(t,r,n,o){var a,i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=o).imageUrl=n,i=this.getUserBooksAsFBCollection(t).doc(r),e.next=5,i.set(a);case 5:return e.next=7,i.get();case 7:if(!(s=e.sent).exists){e.next=12;break}return e.abrupt("return",s.data());case 12:throw new m(500,"Something went wrong while saving private book");case 13:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return a.apply(this,arguments)})},{key:"removePrivateBook",value:(o=et(regeneratorRuntime.mark((function e(t,r,n){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=this.getUserBooksAsFBCollection(t),e.next=4,o.doc(r).delete();case 4:if(n.includes("nophoto")){e.next=7;break}return e.next=7,f.a.storage().refFromURL(n).delete();case 7:return e.abrupt("return",!0);case 10:throw e.prev=10,e.t0=e.catch(0),console.log(e.t0),new m(500,"Something went wrong while removing private book");case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(e,t,r){return o.apply(this,arguments)})}])&&tt(t.prototype,r),n&&tt(t,n),e}();function nt(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function ot(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){nt(a,n,o,i,s,"next",e)}function s(e){nt(a,n,o,i,s,"throw",e)}i(void 0)}))}}function at(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var it=new Pe,st=new Je,ut=new rt,ct=new Ie(st),ft=new(function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userService=t,this.userBooksService=r,this.privateBookService=n,this.getUser=this.getUser.bind(this),this.getUserBooks=this.getUserBooks.bind(this),this.getCollection=this.getCollection.bind(this),this.addToCollection=this.addToCollection.bind(this),this.deleteBook=this.deleteBook.bind(this),this.setFavorite=this.setFavorite.bind(this),this.getFavoriteBooks=this.getFavoriteBooks.bind(this),this.updateBook=this.updateBook.bind(this),this.getUserGenres=this.getUserGenres.bind(this),this.savePrivateBook=this.savePrivateBook.bind(this),this.getAllPrivateBooks=this.getAllPrivateBooks.bind(this),this.getPrivateBookById=this.getPrivateBookById.bind(this),this.removePrivateBook=this.removePrivateBook.bind(this)}var t,r,n,o,a,i,s,u,c,f,p,l,h,d,v,g;return t=e,(r=[{key:"getUser",value:(g=ot(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Get User request accepted"),n=ye(t),e.next=5,this.userService.getUserById(n.id);case 5:o=e.sent,r.json(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,t){return g.apply(this,arguments)})},{key:"getUserBooks",value:(v=ot(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Get User Books request accepted"),n=ye(t),e.next=5,this.userBooksService.getUserBooksAsArray(n.id);case 5:o=e.sent,r.json(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,t){return v.apply(this,arguments)})},{key:"getCollection",value:(d=ot(regeneratorRuntime.mark((function e(t,r){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=t.params.collection,console.log("Get Books from ".concat(n," request accepted")),n){e.next=5;break}throw new m(400,"Book status is invalid");case 5:return o=ye(t),e.next=8,this.userBooksService.getUserCollection(o.id,n);case 8:a=e.sent,r.json(a),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return d.apply(this,arguments)})},{key:"addToCollection",value:(h=ot(regeneratorRuntime.mark((function e(t,r){var n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=t.params.collection,console.log("Get Books from ".concat(n," request accepted")),(o=t.body.book)&&n){e.next=6;break}throw new m(400,"Params are invalid");case 6:return a=ye(t),e.next=9,this.userBooksService.addToUserCollection(a.id,n,o);case 9:i=e.sent,r.json(i),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 16:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e,t){return h.apply(this,arguments)})},{key:"deleteBook",value:(l=ot(regeneratorRuntime.mark((function e(t,r){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Book Delete Request accepted"),(n=t.query.bookId)&&!isNaN(n)){e.next=5;break}throw new m(400,"Book params are invalid");case 5:return o=ye(t),e.next=8,this.userBooksService.deleteBookFromCollection(o.id,n);case 8:a=e.sent,r.json(a),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return l.apply(this,arguments)})},{key:"setFavorite",value:(p=ot(regeneratorRuntime.mark((function e(t,r){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Favorite book request accepted"),n=t.body.book){e.next=5;break}throw new m(400,"Invalid parameter");case 5:return o=ye(t),e.next=8,this.userBooksService.setFavorite(o.id,n);case 8:a=e.sent,r.json(a),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return p.apply(this,arguments)})},{key:"getFavoriteBooks",value:(f=ot(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Get favorite books request accepted"),n=ye(t),e.next=5,this.userBooksService.getFavorites(n.id);case 5:o=e.sent,r.json(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,t){return f.apply(this,arguments)})},{key:"updateBook",value:(c=ot(regeneratorRuntime.mark((function e(t,r){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Update Book request accepted"),n=t.body.book){e.next=5;break}throw new m(400,"Invalid parameter");case 5:return o=ye(t),e.next=8,this.userBooksService.updateBook(o.id,n);case 8:a=e.sent,r.json(a),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return c.apply(this,arguments)})},{key:"getUserGenres",value:(u=ot(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("GET User Genres request accepted"),n=ye(t),e.next=5,this.userBooksService.getUserGenres(n.id);case 5:o=e.sent,r.json(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e,t){return u.apply(this,arguments)})},{key:"savePrivateBook",value:(s=ot(regeneratorRuntime.mark((function e(t,r){var n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Save User's private book request accepted"),e.prev=1,n=ye(t),o=t.body,a=t.file,console.log(o),console.log(a),e.next=9,this.privateBookService.saveUserBook(n.id,o,a);case 9:i=e.sent,r.json(i),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 16:case"end":return e.stop()}}),e,this,[[1,13]])}))),function(e,t){return s.apply(this,arguments)})},{key:"getAllPrivateBooks",value:(i=ot(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("GET User's private books request accepted"),e.prev=1,n=ye(t),e.next=5,this.privateBookService.getPrivateBooks(n.id);case 5:o=e.sent,r.json(o),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 12:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e,t){return i.apply(this,arguments)})},{key:"getPrivateBookById",value:(a=ot(regeneratorRuntime.mark((function e(t,r){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Get User's private book By Id"),e.prev=1,n=ye(t),o=t.params.id,e.next=6,this.privateBookService.getPrivateBookById(n.id,o);case 6:a=e.sent,r.json(a),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 13:case"end":return e.stop()}}),e,this,[[1,10]])}))),function(e,t){return a.apply(this,arguments)})},{key:"removePrivateBook",value:(o=ot(regeneratorRuntime.mark((function e(t,r){var n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Delete User's private book request accepted"),e.prev=1,n=ye(t),o=t.query.id,a=t.query.url,console.log(a),e.next=8,this.privateBookService.removePrivateBook(n.id,o,a);case 8:i=e.sent,r.json(i),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e,t){return o.apply(this,arguments)})}])&&at(t.prototype,r),n&&at(t,n),e}())(it,ct,ut);function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function lt(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function ht(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function dt(e,t){return(dt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function vt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=yt(e);if(t){var o=yt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return gt(this,r)}}function gt(e,t){return!t||"object"!==pt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function yt(e){return(yt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var bt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&dt(e,t)}(s,e);var t,r,n,o,a,i=vt(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=i.call(this)).formatSeriesService=e,t}return t=s,(r=[{key:"getSeriesByGoodreadsId",value:(o=regeneratorRuntime.mark((function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r="".concat(this.root,"series/").concat(t,"?key=").concat(this.devKey),e.next=4,this.getValueFromGoodreads(r);case 4:if(n=e.sent,o=this.findValue(n,"series"),a=this.findValue(o,"author"),o){e.next=9;break}throw new ErrorWithHttpCode(404,"Data was not found");case 9:return(i=this.formatSeriesService.formatSeriesForSeriesPage(o)).author=this.formatSeriesService.formatSeriesAuthor(a),e.abrupt("return",i);case 14:if(e.prev=14,e.t0=e.catch(0),!e.t0.userMessage){e.next=18;break}throw e.t0;case 18:throw new ErrorWithHttpCode(e.t0.httpCode||500,e.t0.message);case 19:case"end":return e.stop()}}),e,this,[[0,14]])})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){lt(a,r,n,i,s,"next",e)}function s(e){lt(a,r,n,i,s,"throw",e)}i(void 0)}))},function(e){return a.apply(this,arguments)})}])&&ht(t.prototype,r),n&&ht(t,n),s}(z);function mt(e){return(mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function kt(e,t){return(kt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function xt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=St(e);if(t){var o=St(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Ot(this,r)}}function Ot(e,t){return!t||"object"!==mt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function St(e){return(St=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Rt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&kt(e,t)}(a,e);var t,r,n,o=xt(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this)}return t=a,(r=[{key:"formatSeriesAuthor",value:function(e){return e.name._text}},{key:"formatSeriesForAuthorPage",value:function(e){return e.filter((function(e,t,r){return t===r.findIndex((function(t){var r=t.series.title._cdata,n=e.series.title._cdata;return r.toLowerCase()===n.toLowerCase()}))})).map((function(e){return{id:e.series.id._text,title:e.series.title._cdata,rating:e.work.ratings_sum._text}})).sort((function(e,t){return t.rating-e.rating}))}},{key:"formatSeriesForSeriesPage",value:function(e){var t={id:e.id._text,title:e.title._cdata,workCount:e.primary_work_count._text,allWorks:e.series_works_count._text};return t.bookIds=this.formatSeriesWork(e,t.workCount),t}},{key:"formatSeriesWork",value:function(e,t){return e.series_works.series_work.slice(0,t).map((function(e){return e.work.best_book.id._text}))}}])&&wt(t.prototype,r),n&&wt(t,n),a}(ie);function jt(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Bt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Pt=new bt(new Rt),Ct=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.goodreadsSeriesService=t,this.getSeriesById=this.getSeriesById.bind(this)}var t,r,n,o,a;return t=e,(r=[{key:"getSeriesById",value:(o=regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Get Series By Id request accepted!"),(n=t.params.id)&&!isNaN(n)){e.next=5;break}throw new m(400,"Series id is empty");case 5:return ye(t),e.next=8,this.goodreadsSeriesService.getSeriesByGoodreadsId(n);case 8:o=e.sent,r.json(o),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){jt(a,r,n,i,s,"next",e)}function s(e){jt(a,r,n,i,s,"throw",e)}i(void 0)}))},function(e,t){return a.apply(this,arguments)})}])&&Bt(t.prototype,r),n&&Bt(t,n),e}())(Pt);function _t(e){return(_t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ut(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function At(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Ut(a,n,o,i,s,"next",e)}function s(e){Ut(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Ft(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Tt(e,t){return(Tt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Dt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Et(e);if(t){var o=Et(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return It(this,r)}}function It(e,t){return!t||"object"!==_t(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Et(e){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Mt(e){return(Mt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function qt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Gt(e,t){return(Gt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Vt(e);if(t){var o=Vt(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return Yt(this,r)}}function Yt(e,t){return!t||"object"!==Mt(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Vt(e){return(Vt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ht(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Lt(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){Ht(a,n,o,i,s,"next",e)}function s(e){Ht(a,n,o,i,s,"throw",e)}i(void 0)}))}}function Nt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Kt=new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Tt(e,t)}(u,e);var t,r,n,o,a,i,s=Dt(u);function u(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,u),(r=s.call(this)).formatAuthorService=e,r.formatSeriesService=t,r}return t=u,(r=[{key:"getAuthorByGoodreadsId",value:(i=At(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r="".concat(this.root,"author/show/").concat(t,"?key=").concat(this.devKey),e.next=4,this.getValueFromGoodreads(r);case 4:if(n=e.sent,o=this.findValue(n,"author"),a=this.findValue(n,"books"),o&&a){e.next=9;break}throw new ErrorWithHttpCode(404,"Data was not found");case 9:return o=this.formatAuthorService.formatAuthorForAuthorPage(o,a),e.abrupt("return",o);case 13:if(e.prev=13,e.t0=e.catch(0),console.log(e.t0),!e.t0.userMessage){e.next=18;break}throw e.t0;case 18:throw new ErrorWithHttpCode(e.t0.httpCode||500,e.t0.message);case 19:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return i.apply(this,arguments)})},{key:"getAuthorBooks",value:(a=At(regeneratorRuntime.mark((function e(t){var r,n,o,a,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r="".concat(this.root,"author/list/").concat(t,"?key=").concat(this.devKey),e.next=4,this.getValueFromGoodreads(r);case 4:if(n=e.sent,o=this.findValue(n,"author"),o=this.formatAuthorService.formatAuthorMin(o),(a=this.findValue(n,"books"))&&!(a.length<1)){e.next=10;break}throw new ErrorWithHttpCode(404,"Data was not found");case 10:return i=this.formatAuthorService.formatAuthorBooks(a),e.abrupt("return",{author:o,bookIds:i});case 14:if(e.prev=14,e.t0=e.catch(0),console.log(e.t0),!e.t0.userMessage){e.next=19;break}throw e.t0;case 19:throw new ErrorWithHttpCode(e.t0.httpCode||500,e.t0.message);case 20:case"end":return e.stop()}}),e,this,[[0,14]])}))),function(e){return a.apply(this,arguments)})},{key:"getAuthorSeries",value:(o=At(regeneratorRuntime.mark((function e(t){var r,n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r="".concat(this.root,"series/list/").concat(t,".xml?key=").concat(this.devKey),e.next=4,this.getValueFromGoodreads(r);case 4:if(n=e.sent,o=this.findValue(n,"series_work")){e.next=8;break}throw new ErrorWithHttpCode(404,"Data was not found");case 8:return a=this.formatSeriesService.formatSeriesForAuthorPage(o),e.abrupt("return",a);case 12:if(e.prev=12,e.t0=e.catch(0),console.log(e.t0),!e.t0.userMessage){e.next=17;break}throw e.t0;case 17:throw new ErrorWithHttpCode(e.t0.httpCode||500,e.t0.message);case 18:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e){return o.apply(this,arguments)})}])&&Ft(t.prototype,r),n&&Ft(t,n),u}(z))(new(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Gt(e,t)}(a,e);var t,r,n,o=Wt(a);function a(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this)}return t=a,(r=[{key:"formatAuthorForAuthorPage",value:function(e,t){return{id:e.id._text,name:e.name._text,imageUrl:e.large_image_url._cdata,about:this.formatDescription(e.about._cdata),workCount:e.works_count._text,bornDate:e.born_at._text,deathDate:e.died_at._text,bookIds:this.formatAuthorBooks(t)}}},{key:"formatAuthorMin",value:function(e){return{name:e.name._text}}},{key:"formatAuthorBooks",value:function(e){var t=e.book;return this.mapArrayIds(t)}}])&&qt(t.prototype,r),n&&qt(t,n),a}(ie)),new Rt),zt=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.goodreadsAuthorService=t,this.getAuthorInfo=this.getAuthorInfo.bind(this),this.getAuthorBooks=this.getAuthorBooks.bind(this),this.getAuthorSeries=this.getAuthorSeries.bind(this)}var t,r,n,o,a,i;return t=e,(r=[{key:"getAuthorInfo",value:(i=Lt(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Get Author request accepted!"),(n=t.params.id)&&!isNaN(n)){e.next=5;break}throw new m(400,"Request param is not valid");case 5:return ye(t),e.next=8,this.goodreadsAuthorService.getAuthorByGoodreadsId(n);case 8:o=e.sent,r.json(o),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return i.apply(this,arguments)})},{key:"getAuthorBooks",value:(a=Lt(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Get Author's Books request accepted"),n=t.params.id){e.next=5;break}throw new m(400,"Request param is not valid");case 5:return ye(t),e.next=8,this.goodreadsAuthorService.getAuthorBooks(n);case 8:o=e.sent,r.json(o),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return a.apply(this,arguments)})},{key:"getAuthorSeries",value:(o=Lt(regeneratorRuntime.mark((function e(t,r){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Get Author's Series request accepted"),n=t.params.id){e.next=5;break}throw new m(400,"Request param is not valid");case 5:return ye(t),e.next=8,this.goodreadsAuthorService.getAuthorSeries(n);case 8:o=e.sent,r.json(o),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),r.status(e.t0.httpCode).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 15:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return o.apply(this,arguments)})}])&&Nt(t.prototype,r),n&&Nt(t,n),e}())(Kt);function Jt(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function Qt(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Xt=new Je,Zt=new(function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.feedService=t,this.getFeed=this.getFeed.bind(this)}var t,r,n,o,a;return t=e,(r=[{key:"getFeed",value:(o=regeneratorRuntime.mark((function e(t,r){var n,o,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Get Feed request accepted"),n=t.query.date,o=ye(t),n){e.next=10;break}return e.next=7,this.feedService.getAllUserFeed(o.id);case 7:a=e.sent,e.next=13;break;case 10:return e.next=12,this.feedService.getUserFeedByDate(o.id,n);case 12:a=e.sent;case 13:r.json(a),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),r.status(e.t0.httpCode||500).json({httpCode:e.t0.httpCode,message:e.t0.userMessage});case 19:case"end":return e.stop()}}),e,this,[[0,16]])})),a=function(){var e=this,t=arguments;return new Promise((function(r,n){var a=o.apply(e,t);function i(e){Jt(a,r,n,i,s,"next",e)}function s(e){Jt(a,r,n,i,s,"throw",e)}i(void 0)}))},function(e,t){return a.apply(this,arguments)})}])&&Qt(t.prototype,r),n&&Qt(t,n),e}())(Xt),$t=r(10),er=r.n($t)()(),tr=r(11),rr=r.n(tr);global.XMLHttpRequest=r(15);var nr,or=o()(),ar=process.env.PORT;null!=ar&&""!=ar||(ar=4200),or.use(u()()),or.use(i.a.urlencoded({extended:!1})),or.use(i.a.json()),(nr=or).post("/auth/login",M.signInUser),nr.post("/auth/register",M.signUpUser),nr.post("/auth/google/login",M.signInWithGoogle),nr.get("/auth/twitter/url",M.getRequestUrl),nr.post("/auth/twitter/login",M.signInWithTwitter),nr.get("/books/search",xe.searchByTitleOrAuthor),nr.get("/books/:bookId",xe.getBookById),nr.get("/user",ft.getUser),nr.get("/user/books",ft.getUserBooks),nr.get("/user/books/favorite",ft.getFavoriteBooks),nr.post("/user/books/favorite",ft.setFavorite),nr.get("/user/books/:collection",ft.getCollection),nr.post("/user/books/:collection",ft.addToCollection),nr.delete("/user/books",ft.deleteBook),nr.put("/user/books",ft.updateBook),nr.get("/user/genres",ft.getUserGenres),nr.get("/user/feed",Zt.getFeed),nr.get("/series/:id",Ct.getSeriesById),nr.get("/author/:id",zt.getAuthorInfo),nr.get("/author/:id/books",zt.getAuthorBooks),nr.get("/author/:id/series",zt.getAuthorSeries),nr.get("/user/upload",ft.getAllPrivateBooks),nr.get("/user/upload/:id",ft.getPrivateBookById),nr.post("/user/upload",er.single("cover"),ft.savePrivateBook),nr.delete("/user/upload",ft.removePrivateBook),rr.a.initializeApp({apiKey:"AIzaSyBJquLDDsi6VJl8kJQ8zRqAHHyGG0SLD9o",authDomain:"bookshelf-a2203.firebaseapp.com",databaseURL:"https://bookshelf-a2203.firebaseio.com",projectId:"bookshelf-a2203",storageBucket:"bookshelf-a2203.appspot.com",messagingSenderId:"942217212778",appId:"1:942217212778:web:2795a60ea9260c875f6b13",measurementId:"G-SV2WRHQ6G2"}),or.listen(ar,(function(){return console.log("Started on port ".concat(ar,"!"))}));t.default=or}]);